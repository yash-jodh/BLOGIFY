<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blog</title>
  <%- include("./partials/head") %>
</head>

<body>
  <%- include("./partials/navbar") %>

  <!-- BLOG CONTENT -->
  <div class="container mt-4">
    <h1><%= blog.title %></h1>

    <img 
      src="<%= blog.coverImageURL %>" 
      alt="Blog Image"
      width="300px"
      class="img-fluid rounded mb-3"
    >

    <pre><%= blog.body %></pre>

    <!-- âœ… DELETE BUTTON (ONLY OWNER) -->
    <% if (user && blog.createdBy && user._id.toString() === blog.createdBy._id.toString()) { %>
      <form 
        action="/blog/delete/<%= blog._id %>" 
        method="POST" 
        onsubmit="return confirm('Are you sure you want to delete this blog?')"
      >
        <button class="btn btn-danger mt-2">
          Delete Blog
        </button>
      </form>
    <% } %>
  </div>

  <!-- AUTHOR INFO -->
  <div class="container mt-4 d-flex align-items-center gap-2">
    <img 
      src="<%= blog.createdBy.profileImageURL %>" 
      width="40px" 
      class="rounded-circle"
    >
    <strong><%= blog.createdBy.fullName %></strong>
  </div>

  <!-- COMMENTS -->
  <div class="container mt-4">
    <h3>Comments (<%= comments.length %>)</h3>

    <% if (user) { %>
      <form action="/blog/comment/<%= blog._id %>" method="POST">
        <div class="mb-3">
          <input 
            name="content" 
            type="text" 
            class="form-control" 
            placeholder="Enter your comment"
            required
          >
          <button class="btn btn-primary mt-2" type="submit">
            Add Comment
          </button>
        </div>
      </form>
    <% } %>

    <div class="mt-3">
      <% comments.forEach(comment => { %>
        <div class="mb-3">
          <img 
            src="<%= comment.createdBy.profileImageURL %>" 
            width="35px" 
            class="rounded-circle"
          >
          <strong><%= comment.createdBy.fullName %></strong>
          <pre class="mb-0"><%= comment.content %></pre>
        </div>
      <% }) %>
    </div>
  </div>

  <%- include("./partials/scripts") %>
</body>
</html>
